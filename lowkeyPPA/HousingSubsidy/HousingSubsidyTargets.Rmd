---
title: "Audience Targetting for Housing Subsidies"
author: "Trevor Kapuvari"
date: "October 13,2023"
output:
  html_document:
    toc: true
    toc_float: true
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(message = FALSE, warning = FALSE)
```

# Motivation of the Analysis





```{r load_packages, warning = FALSE}
options(scipen=10000000)

library(tidyverse)
library(kableExtra)
library(caret)
library(knitr) 
library(pscl)
library(plotROC)
library(pROC)
library(lubridate)
```

```{r load_data, cache = TRUE}
palette5 <- c("#981FAC","#CB0F8B","#FF006A","#FE4C35","#FE9900")
palette4 <- c("#981FAC","#FF006A","#FE4C35","#FE9900")
palette2 <- c("#981FAC","#FF006A")


housingsubsidy <- read.csv("https://github.com/urbanSpatial/Public-Policy-Analytics-Landing/raw/master/DATA/Chapter6/housingSubsidy.csv")


```

# Data Exploration

```{r exploratory_continuous}
  housingsubsidy %>%
    dplyr::select(y,unemploy_rate, mortgage, taxbill_in_phl, cons.price.idx, inflation_rate, cons.conf.idx) %>%
    gather(Variable, value, -y) %>%
      ggplot(aes(y, value, fill=y)) + 
        geom_bar(position = "dodge", stat = "summary", fun = "mean") + 
        facet_wrap(~Variable, scales = "free") +
        scale_fill_manual(values = palette2) +
        labs(x="Click", y="Value", 
             title = "This says fucking nothing",
             subtitle = "(continous outcomes)") +
        theme(legend.position = "none")
```

```{r exploratory_continuous_density, message = FALSE, warning = FALSE}
housingsubsidy %>%
    dplyr::select(y,unemploy_rate, mortgage, taxbill_in_phl, cons.price.idx, inflation_rate, cons.conf.idx) %>%
    gather(Variable, value, -y) %>%
    ggplot() + 
    geom_density(aes(value, color=y), fill = "transparent") + 
    facet_wrap(~Variable, scales = "free") +
    scale_fill_manual(values = palette2) +
    labs(title = "Feature distributions click vs. no click",
         subtitle = "(continous outcomes)")
```

```{r exploratory_binary, message = FALSE, warning = FALSE}
housingsubsidy %>%
    dplyr::select(y, month, poutcome, education) %>%
    gather(Variable, value, -y) %>%
    count(Variable, value, y) %>%
      ggplot(., aes(value, n, fill = y)) +   
        geom_bar(position = "dodge", stat="identity") +
        facet_wrap(~Variable, scales="free") +
        scale_fill_manual(values = palette2) +
        labs(x="Click", y="Value",
             title = "Feature associations with the likelihood of click",
             subtitle = "Categorical features") +
        theme(axis.text.x = element_text(angle = 45, hjust = 1))
```


```{r exploratory_continuous}
housingsubsidy %>%
  dplyr::select(age,previous, unemploy_rate, cons.price.idx, cons.conf.idx, inflation_rate, spent_on_repairs, y) %>%
  gather(variable, value, -y) %>%
  group_by(y, variable) %>% summarise(mean=mean(value)) %>%
ggplot(aes(x=y,y=mean,fill=y))+
  geom_bar(stat='identity')+
  facet_wrap(~variable,scales = "free")+
  labs(x="Enter Housing Subsity Program", y="Value", 
      title = "Feature associations with likelihood of entering housing subsidy program",
      subtitle = "Continous outcomes")
      
```

```{r Training and Test Set}
inTrain <- createDataPartition(
              y = paste(housingsubsidy), 
              p = .65, list = FALSE)
HS.training <- housingsubsidy[inTrain,] 
HS.test <- housingsubsidy[-inTrain,]  
 
reg.training <- 
  lm(y ~ ., data = as.data.frame(HS.training) %>% 
                        dplyr::select(age, previous, unemploy_rate, cons.price.idx, cons.conf.idx, inflation_rate, spent_on_repairs, y))

stargazer(reg.training,type='text', title='Housing Subsidy Join Results', keep.stat = c('n','rsq'))
```

# Non Continuous Variables
```{r exploratory_non_continuous}

housing_subsity %>%
  dplyr::select()

```


